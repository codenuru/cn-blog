# Migration `20201029192011-fix-tag-category`

This migration has been generated by enes esen at 10/29/2020, 10:20:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Category" DROP CONSTRAINT "Category_postId_fkey"

ALTER TABLE "public"."Tag" DROP CONSTRAINT "Tag_postId_fkey"

ALTER TABLE "public"."Category" DROP COLUMN "postId"

ALTER TABLE "public"."Tag" DROP COLUMN "postId"

CREATE TABLE "public"."_CategoryToPost" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_PostToTag" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "_CategoryToPost_AB_unique" ON "public"."_CategoryToPost"("A", "B")

CREATE INDEX "_CategoryToPost_B_index" ON "public"."_CategoryToPost"("B")

CREATE UNIQUE INDEX "_PostToTag_AB_unique" ON "public"."_PostToTag"("A", "B")

CREATE INDEX "_PostToTag_B_index" ON "public"."_PostToTag"("B")

ALTER TABLE "public"."_CategoryToPost" ADD FOREIGN KEY("A")REFERENCES "public"."Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToPost" ADD FOREIGN KEY("B")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTag" ADD FOREIGN KEY("A")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTag" ADD FOREIGN KEY("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201025165547-tagsandcategories..20201029192011-fix-tag-category
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id          Int         @default(autoincrement()) @id
@@ -29,10 +29,10 @@
   authorId    Int?
   viewCount   Int         @default(0)
   likeCount   Int         @default(0)
   comments    Comment[]
-  categories  Category[]
-  tags        Tag[]
+  categories  Category[]  @relation(references: [id])
+  tags        Tag[]       @relation(references: [id])
   createdAt   DateTime    @default(now())
   updatedAt   DateTime    @updatedAt
 }
@@ -50,18 +50,16 @@
 model Category {
   id          Int         @default(autoincrement()) @id
   name        String      @unique
   slug        String      @unique
-  post        Post        @relation(fields: [postId], references: [id])
-  postId      Int
+  posts       Post[]      @relation(references: [id])
 }
 model Tag {
   id          Int         @default(autoincrement()) @id
   name        String      @unique
   slug        String      @unique
-  post        Post        @relation(fields: [postId], references: [id])
-  postId      Int
+  posts       Post[]      @relation(references: [id])
 }
 enum Role {
   SUPER_USER
```


